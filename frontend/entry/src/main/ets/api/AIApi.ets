import { request } from '../utils/HttpUtil'
import { http } from '@kit.NetworkKit';

// AI å›å¤çš„æ¶ˆæ¯ä½“
export interface AiMessage {
  role: string;
  content: string;
}

// AI è¿”å›çš„é€‰æ‹©é¡¹
export interface AiChoice {
  index: number;
  message: AiMessage;
  finish_reason: string;
}

// DeepSeek/OpenAI æ ‡å‡†å“åº”ç»“æ„
interface GeneratedTypeLiteralInterface_1 {
  prompt_tokens: number;
  completion_tokens: number;
  total_tokens: number;
}

export interface DeepSeekResponse {
  id: string;
  choices: AiChoice[];
  created: number;
  model: string;
  usage: GeneratedTypeLiteralInterface_1;
}

export class AiApi {
  /**
   * å‘é€æ—¥è®°ç»™åç«¯ï¼Œç”±åç«¯è½¬è°ƒ DeepSeek
   * @param userId ç”¨æˆ·ID
   * @returns AI åˆ†æåçš„çº¯æ–‡å­—å†…å®¹
   */
  static async analyzeDiary(userId: number): Promise<string> {
    // ğŸ’¡ æ³›å‹ä¼  stringï¼Œå› ä¸ºæˆ‘ä»¬åç«¯çš„ R<T> æœ€ç»ˆä¼šè¿”å›å¤„ç†å¥½çš„å­—ç¬¦ä¸²
    const res = await request<string>('http://10.0.2.2:8080/api/ai/analyze', {
      method: http.RequestMethod.POST,
      header: { 'Content-Type': 'application/json' },
      extraData: JSON.stringify({ userId: userId })
    })

    return res ?? "AI è¿˜æ²¡å‡†å¤‡å¥½ï¼Œè¯·ç¨åå†è¯•"
  }
}